<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Round 3 Interview - HR Round</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
/* --- STYLES (Retained) --- */
body { margin:0; font-family:'Poppins',sans-serif; background:linear-gradient(135deg,#0a0a0a,#1a1a2e,#2b2b4d); background-size:400% 400%; animation:gradientBG 15s ease infinite; display:flex; justify-content:center; align-items:center; height:100vh; }
@keyframes gradientBG { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
.interview-box { width:95%; max-width:900px; display:flex; flex-direction:column; align-items:center; background:rgba(30,30,60,0.95); padding:30px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.7); position:relative; }
h1 { color:#9b86ff; text-align:center; margin-bottom:30px; }
.interviewers-area { width:100%; position:relative; margin-bottom:100px; }
.interviewers { display:flex; justify-content:space-around; width:100%; }
.interviewer { position:relative; width:140px; height:140px; border-radius:50%; border:3px solid #785aed; overflow:visible; background:#000; margin:0 12px; }
.interviewer img,.interviewer video { width:140px; height:140px; border-radius:50%; object-fit:cover; }
.interviewer video { position:absolute; top:50%; left:50%; width:160px; height:160px; transform:translate(-50%,-50%); display:none; }
.status-circle { width:22px; height:22px; border-radius:50%; background:#fff; border:3px solid #fff; position:absolute; top:-10px; right:-10px; box-shadow:0 1px 8px rgba(0,0,0,0.12); z-index:10; transition:background 0.3s,border 0.3s; }
.status-circle.active { background:#36d46c; border-color:#fff; }
.popup-bar { position:absolute; top:100%; left:0; width:100%; margin-top:20px; background:#1a1a2e; color:#fff; font-weight:600; padding:18px 30px; border-radius:36px; box-shadow:0 5px 15px rgba(0,0,0,0.6); font-size:1.12rem; text-align:center; display:none; }
.popup-bar.error { background:#a3344c; }
.candidate { position:relative; width:160px; height:160px; border-radius:50%; border:3px solid #ff9800; overflow:hidden; margin-bottom:45px; }
.candidate img,.candidate video { width:160px; height:160px; border-radius:50%; object-fit:cover; }
.candidate video { display:none; }
.btn-container { display:flex; gap:25px; margin-top:10px; justify-content:center; }
.btn { padding:15px 35px; border-radius:12px; border:none; font-weight:700; font-size:1.1rem; cursor:pointer; background:#785aed; color:#fff; transition:transform 0.2s, background 0.3s; }
.btn:hover { background:#9b86ff; transform:scale(1.05); }
.score-circle { position:absolute; top:30px; right:30px; width:70px; height:70px; border-radius:50%; background:#ff9800; color:#0a0a0a; display:flex; flex-direction:column; justify-content:center; align-items:center; font-weight:800; font-size:1.2rem; box-shadow:0 0 15px rgba(255,152,0,0.8); z-index:20; padding:5px; line-height:1; opacity:1; }
.score-circle small { font-size:0.6rem; font-weight:600; color:#333; margin-top:-3px; }
.next-round-btn { background:#36d46c; }
.next-round-btn:hover { background:#6cf098; }
</style>
</head>
<body>
<div class="interview-box">
<h1>Round 3 Interview - HR Round</h1>
<div class="score-circle" id="scoreCircle"><span id="currentScore">0</span><small id="totalQuestions">/0</small></div>
<div class="interviewers-area">
<div class="interviewers">
<div class="interviewer" data-index="0"><img src="avatar1.jpg" alt="HR 1"/><video src="avatar1.mp4" loop muted playsinline></video><div class="status-circle"></div></div>
<div class="interviewer" data-index="1"><img src="avatar2.jpg" alt="HR 2"/><video src="avatar2.mp4" loop muted playsinline></video><div class="status-circle"></div></div>
<div class="interviewer" data-index="2"><img src="avatar3.jpg" alt="HR 3"/><video src="avatar3.mp4" loop muted playsinline></video><div class="status-circle"></div></div>
<div class="interviewer" data-index="3"><img src="avatar4.jpg" alt="HR 4"/><video src="avatar4.mp4" loop muted playsinline></video><div class="status-circle"></div></div>
</div>
<div class="popup-bar" id="popupBar"><span id="popupText"></span></div>
</div>
<div class="candidate"><img src="candidate.jpg" alt="Candidate"/><video src="candidate.mp4" loop muted playsinline></video></div>
<div class="btn-container" id="initial-btn-container"><button class="btn" id="startBtn" disabled>Start HR Interview</button></div>

<div class="btn-container" id="answerBtnContainer" style="display:none; margin-top:18px;">
¬† <p style="color:#FFF; opacity:0.7; font-size:1.1rem; width:100%; text-align:center;">
¬† ¬† **üé§ Microphone is Active. You have 15 seconds to answer.**
¬† </p>
</div>

<div class="btn-container" id="roundNavContainer" style="display:none; margin-top:18px;"><button class="btn next-round-btn" id="finishBtn">Finish Interview üèÅ</button></div>
</div>

<script>
let questions=[],allQuestions=[],currentQ=0,score=0,voices=[],currentInterviewer=0;
const TOTAL_INTERVIEWERS=4,MAX_SCORE_PER_Q=4,NUM_QUESTIONS_IN_ROUND=4,interviewerVoices=["male","female","female","male"];
let speechRecognizer=null;

// DOM Elements
const interviewerEls=document.querySelectorAll(".interviewer");
const statusEls=document.querySelectorAll(".status-circle");
const candidateImg=document.querySelector(".candidate img");
const candidateVid=document.querySelector(".candidate video");
const answerBtnContainer=document.getElementById("answerBtnContainer");
const roundNavContainer=document.getElementById("roundNavContainer");
const finishBtn=document.getElementById("finishBtn");

// VOICE FUNCTIONS
function loadVoices(){voices=window.speechSynthesis.getVoices()||[];if(!voices.length)setTimeout(loadVoices,200);}
if('speechSynthesis'in window){loadVoices();window.speechSynthesis.onvoiceschanged=loadVoices;}
function getVoice(gender){const englishVoices=voices.filter(v=>/en/i.test(v.lang));if(!englishVoices.length)return voices[0];const filtered=englishVoices.filter(v=>gender==="female"?/female|woman|zira|susan|samantha|kate|amelia/i.test(v.name):/male|man|david|alex|mark|michael|daniel|tom/i.test(v.name));return filtered.length?filtered[0]:englishVoices[0];}
function speakInterviewer(i,text,cb){if('speechSynthesis'in window)window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(text);u.voice=getVoice(interviewerVoices[i]);u.rate=1;toggleAvatar(i,true);showPopup(text);u.onend=()=>{toggleAvatar(i,false);cb&&cb();};u.onerror=()=>{toggleAvatar(i,false);cb&&cb();};window.speechSynthesis.speak(u);}

// UTILITY/UI FUNCTIONS
function updateScore(){document.getElementById("currentScore").textContent=score;}
function updateIndicator(i){statusEls.forEach((el,idx)=>el.classList.toggle("active",idx===i));}
function showPopup(msg,error=false){const bar=document.getElementById("popupBar");const text=document.getElementById("popupText");text.textContent=msg;bar.classList.toggle("error",error);bar.style.display="block";setTimeout(()=>{bar.style.display="none";},error?2500:4000);}
function toggleAvatar(i,speaking){interviewerEls.forEach((el,idx)=>{const img=el.querySelector("img");const vid=el.querySelector("video");if(idx===i&&speaking){img.style.display="none";vid.style.display="block";vid.play().catch(()=>{});}else{img.style.display="block";vid.pause();vid.style.display="none";}});}
function candidateSpeak(active){candidateImg.style.display=active?"none":"block";candidateVid.style.display=active?"block":"none";if(active)candidateVid.play().catch(()=>{});else candidateVid.pause();}

// SPEECH RECOGNITION
function getCandidateAnswer(){
¬† candidateSpeak(true);
¬† answerBtnContainer.style.display="flex"; 

¬† const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
¬† if(!SpeechRecognition){
¬† ¬† candidateSpeak(false);
¬† ¬† // NOTE: Updated prompt text to reflect 15s limit, even if mic is not supported
¬† ¬† showPopup("Speech Recognition not supported. Proceeding after 15 seconds.",true); 
¬† ¬† setTimeout(evaluateAnswer, 15000); // 15-second timeout
¬† ¬† return;
¬† }
¬† if(speechRecognizer)speechRecognizer.stop();
¬† speechRecognizer=new SpeechRecognition();
¬† speechRecognizer.lang='en-US';
¬† speechRecognizer.interimResults=false;
¬† speechRecognizer.continuous=true;
¬† 
¬† const answerTimeout=setTimeout(()=>{
¬† ¬† if(speechRecognizer)speechRecognizer.stop();
¬† ¬† showPopup("Time limit reached. Evaluating answer.",true);
¬† }, 15000); // *** CHANGED: 15-second listen limit ***

¬† speechRecognizer.onresult=ev=>{
¬† ¬† let finalTranscript='';
¬† ¬† for(let i=ev.resultIndex;i<ev.results.length;++i){
¬† ¬† ¬† if(ev.results[i].isFinal){finalTranscript+=ev.results[i][0].transcript;}
¬† ¬† }
¬† ¬† if(finalTranscript){
¬† ¬† ¬† showPopup(`Heard: "${finalTranscript}"`,false);
¬† ¬† } else {
¬† ¬† ¬† showPopup("Microphone is listening...",false);
¬† ¬† }
¬† };
¬† 
¬† speechRecognizer.onend=()=>{
¬† ¬† clearTimeout(answerTimeout);
¬† ¬† candidateSpeak(false);
¬† ¬† answerBtnContainer.style.display="none";
¬† ¬† evaluateAnswer();
¬† };
¬† 
¬† speechRecognizer.onerror=event=>{
¬† ¬† clearTimeout(answerTimeout);
¬† ¬† candidateSpeak(false);
¬† ¬† answerBtnContainer.style.display="none";
¬† ¬† if(event.error!=='no-speech'){
¬† ¬† ¬† showPopup("Recognition error: "+event.error+". Proceeding to feedback.",true);
¬† ¬† } else {
¬† ¬† ¬† showPopup("No voice detected. Proceeding to feedback.",true);
¬† ¬† }
¬† ¬† evaluateAnswer();
¬† };
¬† 
¬† speechRecognizer.start();
¬† showPopup("Microphone is listening...",false);
}

// CORE INTERVIEW LOGIC
fetch("round3_hr_questions.json").then(res=>res.json()).then(data=>{
¬† allQuestions=data.questions||[];
¬† questions=allQuestions.slice(0,NUM_QUESTIONS_IN_ROUND);
¬† document.getElementById("totalQuestions").textContent="/"+(questions.length*MAX_SCORE_PER_Q);
¬† document.getElementById("startBtn").disabled=false;
}).catch(()=>showPopup("Error loading HR questions. Ensure 'round3_hr_questions.json' exists.",true));

document.getElementById("startBtn").addEventListener("click",()=>{
¬† currentQ=0;score=0;currentInterviewer=0;
¬† updateScore();
¬† document.getElementById("initial-btn-container").style.display="none";
¬† runInterview();
});

function runInterview(){
¬† if(currentQ>=questions.length){
¬† ¬† const finalScore=questions.length*MAX_SCORE_PER_Q;
¬† ¬† showPopup(`HR Round Complete! Final Score: ${score} / ${finalScore}.`,false);
¬† ¬† roundNavContainer.style.display="flex";
¬† ¬† updateIndicator(-1);
¬† ¬† return;
¬† }
¬† const i=currentInterviewer%TOTAL_INTERVIEWERS;
¬† updateIndicator(i);
¬† const q=questions[currentQ].question;
¬† speakInterviewer(i,q,()=>{getCandidateAnswer();});
}

function evaluateAnswer(){
¬† const interviewerIndex=currentInterviewer%TOTAL_INTERVIEWERS;
¬† const points=Math.floor(Math.random()*MAX_SCORE_PER_Q)+1; 
¬† let feedbackMessage="";

¬† switch(points){
¬† ¬† case 4:
¬† ¬† ¬† feedbackMessage="That was a superb answer! Keep up the great work.";
¬† ¬† ¬† break;
¬† ¬† case 3:
¬† ¬† ¬† feedbackMessage="That's a strong response. You hit the core points well. ";
¬† ¬† ¬† break;
¬† ¬† case 2:
¬† ¬† ¬† feedbackMessage="Thank you for sharing. That was a decent start, but your answer could use more structure.";
¬† ¬† ¬† break;
¬† ¬† case 1:
¬† ¬† ¬† feedbackMessage="I appreciate your honesty. ";
¬† ¬† ¬† break;
¬† }
¬† 
¬† score+=points;
¬† updateScore();
¬† 
¬† // Speak feedback. 
¬† speakInterviewer(interviewerIndex,feedbackMessage,()=>{
¬† ¬† currentQ++;
¬† ¬† currentInterviewer++;
¬† ¬† // *** CHANGED: Reduced delay to 2 seconds (2000ms) ***
¬† ¬† setTimeout(runInterview, 2000); 
¬† });
}

finishBtn.addEventListener('click',()=>{
¬† const finalScore=questions.length*MAX_SCORE_PER_Q;
¬† alert(`Interview Simulation Complete! HR Score: ${score}/${finalScore}.`);
¬† 
¬† // Redirect to login.html
¬† window.location.href = "login.html";
});
</script>
</body>
</html>